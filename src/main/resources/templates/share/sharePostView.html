<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #F8F9FA;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    pre {
      background-color: #f4f4f4;
      padding: 15px;
      border-radius: 8px;
      white-space: pre-wrap;
      word-wrap: break-word;
      text-align: left;
      font-size: 15px;
    }

    /* âœ… ê²Œì‹œê¸€ ë‚´ìš© (ë°•ìŠ¤ ì²˜ë¦¬ + ê°€ìš´ë° ì •ë ¬) */
    .post-content {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 20px;
      font-weight: bold;
      word-wrap: break-word;
      white-space: pre-wrap;
      text-align: center;
      margin: 20px auto;
      max-width: 700px;
    }

    /* âœ… ì œëª© ìŠ¤íƒ€ì¼ */
    h1 {
      text-align: center;
    }

    /* âœ… ë²„íŠ¼ê³¼ ì°œ ë²„íŠ¼ì„ ê°™ì€ ì¤„ì— ì •ë ¬ */
    .button-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }

    /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ (í¬ê¸° í†µì¼) */
    .btn {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
      /*transition: background 0.3s, transform 0.2s;*/
      width: 80px;
      height: 40px;
      border: none;
      box-sizing: border-box; /* íŒ¨ë”©ê³¼ í…Œë‘ë¦¬ë¥¼ í¬í•¨í•œ í¬ê¸° ì§€ì • */
    }

    /* âœ… `button` íƒœê·¸ë„ ë™ì¼í•œ í¬ê¸°ë¡œ ê°•ì œ ì„¤ì • */
    .btn-danger {
      background-color: #E74C3C;
      color: white;
      padding: 0; /* ë²„íŠ¼ ë‚´ë¶€ íŒ¨ë”© ì œê±° */
      display: flex;
      justify-content: center;
      align-items: center;
      width: 80px;
      height: 40px;
      box-sizing: border-box;
    }

    .btn-danger:hover {
      background-color: #C0392B;
      /*transform: translateY(-2px);*/
    }

    /* âœ… ë²„íŠ¼ ìƒ‰ìƒ */
    .btn-primary {
      background-color: #505D96;
      color: white;
    }

    .btn-primary:hover {
      background-color: #3A4A7A;
      /*   transform: translateY(-2px);*/
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
      /* transform: translateY(-2px);*/
    }

    /* âœ… ì°œ ë²„íŠ¼ (ë²„íŠ¼ê³¼ í¬ê¸° ë§ì¶¤) */
    .wishlist {
      width: 40px;
      height: 40px;
      cursor: pointer;
      /*transition: transform 0.2s ease-in-out;*/
    }

    .wishlist:hover {
      transform: scale(1.1);
    }

    /* âœ… ê²Œì‹œê¸€ ì •ë³´ ê°€ìš´ë° ì •ë ¬ */
    .post-info {
      text-align: center;
      font-size: 16px;
      color: #333;
      font-weight: bold;
      margin: 10px 0;
    }

    /* âœ… ì´ë¯¸ì§€ í¬ê¸° ì¤„ì´ê¸° */
    .image-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    .image-container img {
      max-width: 400px; /* ì´ë¯¸ì§€ í¬ê¸° ì¤„ì„ */
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      /*transition: transform 0.2s;*/
    }

    /* ğŸ“Œ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #imageModal {
      display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* ğŸ“Œ ëª¨ë‹¬ ë‚´ë¶€ ì´ë¯¸ì§€ */
    #imageModal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }

    /* ğŸ“Œ ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #closeModal {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }


    /* ğŸ“Œ ì´ë¯¸ì§€ ë°•ìŠ¤ */
    .image-box {
      position: relative;
      display: flex;
      justify-content: center;
    }

    .image-box img {
      width: 90%;
      height: auto;
      max-height: 400px;
      border-radius: 10px;
      object-fit: cover;
      cursor: pointer;
    }

    #closeModal {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }

    /* ğŸ“Œ í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px;
      cursor: pointer;
      border-radius: 50%;
      font-size: 20px;
      user-select: none;
      transition: background 0.3s;
    }

    .arrow-left {
      left: 10px;
    }

    .arrow-right {
      right: 10px;
    }

    .arrow:hover {
      background: rgba(0, 0, 0, 0.8);
    }

  </style>
</head>
<body>

<div class="container">

  <!-- ğŸ“Œ ì œëª© -->
  <h1 class="post-title" th:text="${post.txnBoardTitle}"></h1>

  <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ -->
  <div class="image-box">
    <div th:if="${post.photoUrls != null and not #lists.isEmpty(post.photoUrls)}">
      <img th:src="@{${post.photoUrls[0]}}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" id="mainImage">
      <div class="arrow arrow-left" onclick="prevImage()">&#10094;</div>
      <div class="arrow arrow-right" onclick="nextImage()">&#10095;</div>
    </div>

    <div th:if="${post.photoUrls == null or #lists.isEmpty(post.photoUrls)}">
      <img src="/images/default.jpg" alt="ê¸°ë³¸ ì´ë¯¸ì§€">
    </div>

  </div>

  <!-- ğŸ“Œ ê²Œì‹œê¸€ ì •ë³´ -->
  <div class="info">
    <strong>ì‘ì„±ì:</strong> <span th:text="${post.authorName}"></span>
    <span th:text="${#temporals.format(post.postDate, 'yyyy-MM-dd HH:mm')}"></span>
    <br>
    <span class="price-box" th:text="|ê¸ˆì•¡ ${post.price}|"></span>
  </div>

    <!-- âœ… ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="button-container">

      <!-- ì‘ì„±ìë§Œ ìˆ˜ì • ë° ì‚­ì œ ê°€ëŠ¥ -->
      <th:block th:if="${loginUser != null and post.userId == loginUser.username}">
        <a th:href="@{/share/{id}/update(id=${post.txnPostId})}" class="btn btn-primary">ìˆ˜ì •</a>
      </th:block>

      <a href="/share/list" class="btn btn-secondary">ëª©ë¡</a>

      <th:block th:if="${loginUser != null and post.userId == loginUser.username}">
        <form th:action="@{/share/{id}/delete(id=${post.txnPostId})}" method="post"
              onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" style="display: inline;">
          <button type="submit" class="btn btn-danger">ì‚­ì œ</button>
        </form>
      </th:block>

      <!-- âœ… ì°œ ë²„íŠ¼ (í¬ê¸° í†µì¼) -->
      <div class="wishlist"></div>
      <img id="favoriteButton" src="/images/binH.png" alt="ì°œ" class="wishlist" data-post-id="10">
      </div>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const favoriteButton = document.getElementById("favoriteButton");

        favoriteButton.addEventListener("click", function() {
          const postId = favoriteButton.getAttribute("data-post-id");
          const userId = 1; // ì‹¤ì œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì IDë¡œ ë³€ê²½í•´ì•¼ í•¨

          fetch(`/api/favorites/toggle?userId=${userId}&postId=${postId}`, {
            method: "POST",
          })
                  .then(response => response.text())
                  .then(data => {
                    alert(data); // "ê´€ì‹¬ê¸€ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤." ë©”ì‹œì§€ í‘œì‹œ

                    // ì´ë¯¸ì§€ ìƒíƒœ ì—…ë°ì´íŠ¸ (binH <-> fullH)
                    if (favoriteButton.src.includes("binH.png")) {
                      favoriteButton.src = "/images/fullH.png";
                    } else {
                      favoriteButton.src = "/images/binH.png";
                    }
                  })
                  .catch(error => console.error("ì—ëŸ¬ ë°œìƒ:", error));
        });
      });
    </script>


  <!-- ğŸ“Œ ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
  <div id="imageModal">
    <span id="closeModal">&times;</span>
    <img id="modalImage">
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      const closeModal = document.getElementById("closeModal");
      const images = document.querySelectorAll(".image-box img"); // ëª¨ë“  ì´ë¯¸ì§€ ì„ íƒ

      // ğŸ“Œ ì´ë¯¸ì§€ í´ë¦­ ì‹œ í™•ëŒ€ ëª¨ë‹¬ ì—´ê¸°
      images.forEach(image => {
        image.addEventListener("click", function () {
          modal.style.display = "flex";
          modalImg.src = this.src;
        });
      });

      // ğŸ“Œ ëª¨ë‹¬ ë‹«ê¸°
      closeModal.addEventListener("click", function () {
        modal.style.display = "none";
      });

      // ğŸ“Œ ëª¨ë‹¬ ë°”ê¹¥ì„ í´ë¦­í•˜ë©´ ë‹«ê¸°
      modal.addEventListener("click", function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let currentIndex = 0; // í˜„ì¬ ì´ë¯¸ì§€ ì¸ë±ìŠ¤
      let images = []; // ì´ë¯¸ì§€ URL ë°°ì—´

      // ğŸ“Œ Thymeleafë¥¼ ì´ìš©í•˜ì—¬ JavaScriptì—ì„œ ì´ë¯¸ì§€ URL ë°°ì—´ ê°€ì ¸ì˜¤ê¸°
      images = [[${post.photoUrls}]] [];

      let mainImage = document.getElementById("mainImage");
      let leftArrow = document.querySelector(".arrow-left");
      let rightArrow = document.querySelector(".arrow-right");

      // ğŸ“Œ ê¸°ë³¸ ì´ë¯¸ì§€ ì„¤ì •
      if (images.length > 0) {
        mainImage.src = images[0]; // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ì„¤ì •
        currentIndex = 0;
      } else {
        mainImage.src = "/images/default.jpg"; // ê¸°ë³¸ ì´ë¯¸ì§€
        leftArrow.style.display = "none";
        rightArrow.style.display = "none";
      }

      // ğŸ“Œ ì´ë¯¸ì§€ ë³€ê²½ í•¨ìˆ˜
      function changeImage(index) {
        mainImage.style.opacity = "0"; // í˜ì´ë“œì•„ì›ƒ íš¨ê³¼
        setTimeout(() => {
          mainImage.src = images[index];
          mainImage.style.opacity = "1"; // í˜ì´ë“œì¸ íš¨ê³¼
        }, 300);
      }

      // ğŸ“Œ ì´ì „ ì´ë¯¸ì§€
      window.prevImage = function () {
        if (images.length === 0) return;
        currentIndex = (currentIndex === 0) ? images.length - 1 : currentIndex - 1;
        changeImage(currentIndex);
      };

      // ğŸ“Œ ë‹¤ìŒ ì´ë¯¸ì§€
      window.nextImage = function () {
        if (images.length === 0) return;
        currentIndex = (currentIndex === images.length - 1) ? 0 : currentIndex + 1;
        changeImage(currentIndex);
      };

      // ğŸ“Œ ì´ë¯¸ì§€ í•œ ê°œë§Œ ìˆì„ ê²½ìš° í™”ì‚´í‘œ ìˆ¨ê¹€
      if (images.length <= 1) {
        leftArrow.style.display = "none";
        rightArrow.style.display = "none";
      }
    });
  </script>
</body>
</html>
