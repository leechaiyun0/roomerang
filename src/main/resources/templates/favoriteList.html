<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>관심글 목록</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<h2>관심글 목록</h2>

<!-- 로그인한 사용자 ID -->
<input type="hidden" id="userId" th:value="${userId}">

<table>
  <thead>
  <tr>
    <th>게시글 제목</th>
    <th>카테고리</th>
    <th>취소</th>
  </tr>
  </thead>
  <tbody>
  <!-- 관심글 목록을 반복해서 표시 -->
  <tr th:each="post : ${favoritePosts}">
    <td>
      <a th:href="@{/{postType}View(id=${post.postId})}" th:text="${post.postTitle}"></a>
    </td>
    <td th:text="${post.postType}"></td>
    <td>
      <button class="remove-btn" th:data-postid="${post.postId}" th:data-posttype="${post.postType}">❌</button>
    </td>
  </tr>
  </tbody>
</table>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll(".remove-btn").forEach(btn => {
          btn.addEventListener("click", function() {
              var userId = document.getElementById("userId").value;
              var postId = this.getAttribute("data-postid");
              var postType = this.getAttribute("data-posttype");

              fetch('/favorite/toggle?userId=' + userId + '&postId=' + postId + '&postType=' + postType, {
                  method: 'POST'
              })
              .then(response => response.text())
              .then(data => {
                  alert(data);
                  location.reload(); // 페이지 새로고침
              });
          });
      });
  });
</script>

</body>
</html>